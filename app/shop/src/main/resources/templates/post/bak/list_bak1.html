<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
<meta charset="UTF-8">
<title>게시판 리스트 화면 테스트</title>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="/js/common/common.js"></script>
<script src="/js/common/message.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    $(function () {
        getPosts();
    })

    function getPosts() {
        const data = [[ ${posts.data} ]];
        if (!data) {
            document.getElementById('list').innerHTML = '<td colspan="7"><div className="no_data_msg">검색된 결과가 없습니다.</div></td>';
            renderPaginationHTML();
        }

        const pagination = [[ ${posts.pagination} ]];
        const searchRequestDto = [[ ${searchRequestDto} ]];
        let num = pagination.totalRecordCount - ((searchRequestDto.pageNo - 1) * searchRequestDto.recordSizePerPage);

        renderListHTML(data, num);
        renderPaginationHTML(pagination, searchRequestDto);
    }

    function renderListHTML(data, num) {
        let html = '';
        data.forEach(post => {
            html += `
                <tr>
                    <td><input type="checkbox" /></td>
                    <td>${post.fixedYn === 'N' ? num-- : '공지'}</td>
                    <td><a href="/post/${post.postId}">${post.title}</a></td>
                    <td><a href="/post/${post.postId}">${post.content}</a></td>
                    <td>${post.writer}</td>
                    <td>${post.createDate}</td>
                    <td>${post.readCnt}</td>
                </tr>
            `;
        })

        document.getElementById('list').innerHTML = html;
    }

    function renderPaginationHTML(pagination, searchRequestDto) {
        if (!pagination || !searchRequestDto) {
            document.querySelector('.paging').innerHTML = '';
            throw new Error('Missing required parameters..');
        }

        let html = '';
        if (pagination.existsPrevPage) {
            html += `
                <a href="javascript:void(0);" onclick="movePageWithPageNo(1)" class="page_bt first">첫 페이지</a>
                <a href="javascript:void(0);" onclick="movePageWithPageNo(${pagination.startPage - 1})" class="page_bt prev">이전 페이지</a>
            `;
        }

        html += '<p>';
        for (let i = pagination.startPage; i <= pagination.endPage; i++) {
            html += (i !== searchRequestDto.pageNo)
                ? `<a href="javascript:void(0);" onclick="movePageWithPageNo(${i});">${i}</a>`
                : `<span class="on">${i}</span>`
        }
        html += '</p>';

        if (pagination.existsNextPage) {
            html += `
                <a href="javascript:void(0);" onclick="movePageWithPageNo(${pagination.endPage + 1});" class="page_bt next">다음 페이지</a>
                <a href="javascript:void(0);" onclick="movePageWithPageNo(${pagination.totalPageCount});" class="page_bt last">마지막 페이지</a>
            `;
        }

        document.querySelector('.paging').innerHTML = html;
    }

    function movePageWithPageNo(pageNo) {
        const queryString = {
            pageNo: (pageNo) ? pageNo : 1, // 현재 page 번호
            recordSizePerPage: 10, // 페이지당 출력 데이터 갯수
            pageSize: 10 // 페이지 사이즈 (1, 2, 3, 4, 5..)
        }
        location.href = location.pathname + '?' + new URLSearchParams(queryString).toString();
    }
    /*]]>*/
</script>
</head>
<div class="page_tits">
    <h3>게시판 관리</h3>
    <p class="path"><strong>현재 위치 :</strong> <span>게시판 관리</span> <span>리스트형</span> <span>리스트</span></p>
</div>

<div class="content">
    <section>
        <!--/* 검색 */-->
        <div class="search_box">
            <form id="searchForm" onsubmit="return false;" autocomplete="off">
                <div class="sch_group fl">
                    <select title="검색 유형 선택">
                        <option value="">전체 검색</option>
                        <option value="">제목</option>
                        <option value="">내용</option>
                    </select>
                    <input type="text" placeholder="키워드를 입력해 주세요." title="키워드 입력"/>
                    <button type="button" class="bt_search"><i class="fas fa-search"></i><span class="skip_info">검색</span></button>
                </div>
            </form>
        </div>

        <!--/* 리스트 */-->
        <table class="tb tb_col">
            <colgroup>
                <col style="width:50px;"/><col style="width:7.5%;"/><col style="width:auto;"/><col style="width:10%;"/><col style="width:15%;"/><col style="width:7.5%;"/>
            </colgroup>
            <thead>
            <tr>
                <th scope="col"><input type="checkbox"/></th>
                <th scope="col">번호</th>
                <th scope="col">제목</th>
                <th scope="col">내용</th>
                <th scope="col">작성자</th>
                <th scope="col">등록일</th>
                <th scope="col">조회수</th>
            </tr>
            </thead>

            <!--/* 리스트 데이터 렌더링 영역 */-->
            <tbody id="list">

            </tbody>
        </table>

        <!--/* 페이지네이션 렌더링 영역 */-->
        <div class="paging">

        </div>

        <!--/* 게시글 저장 페이징 이동 버튼 */-->
        <!--<p class="btn_set tr">
            <a th:href="@{/post/}" class="btns btn_st3 btn_mid">글쓰기</a>
        </p>-->
    </section>
</div>
</html>